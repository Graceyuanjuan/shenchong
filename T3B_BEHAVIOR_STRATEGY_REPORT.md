# T3-B: è¡Œä¸ºç­–ç•¥å°è£…æ¨¡å— - å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

T3-B è¡Œä¸ºç­–ç•¥å°è£…æ¨¡å—æ˜¯ä¸€ä¸ªçµæ´»ä¸”å¼ºå¤§çš„è¡Œä¸ºç®¡ç†ç³»ç»Ÿï¼ŒåŸºäº `PetState + EmotionType` ç»„åˆæä¾›æ™ºèƒ½çš„è¡Œä¸ºç­–ç•¥æ˜ å°„å’Œæ‰§è¡Œã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ç­–ç•¥æ˜ å°„ç³»ç»Ÿ
- âœ… **çŠ¶æ€ + æƒ…ç»ªç»„åˆæ˜ å°„**: æ”¯æŒåŸºäºå® ç‰©çŠ¶æ€å’Œæƒ…ç»ªçš„ç²¾ç¡®ç­–ç•¥åŒ¹é…
- âœ… **ä¼˜å…ˆçº§æ’åº**: è‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œç¡®ä¿é‡è¦ç­–ç•¥ä¼˜å…ˆæ‰§è¡Œ
- âœ… **æ¡ä»¶æ£€æŸ¥**: æ”¯æŒæƒ…ç»ªå¼ºåº¦ã€æ—¶é—´èŒƒå›´ã€è‡ªå®šä¹‰æ¡ä»¶ç­‰å¤šç§è§¦å‘æ¡ä»¶
- âœ… **å†·å´æ—¶é—´**: é˜²æ­¢ç­–ç•¥è¿‡åº¦æ‰§è¡Œï¼Œæä¾›å¹³æ»‘çš„ç”¨æˆ·ä½“éªŒ

### 2. è¡Œä¸ºæ‰§è¡Œç³»ç»Ÿ
- âœ… **å»¶æ—¶æ‰§è¡Œ**: æ”¯æŒæ¯«ç§’çº§ç²¾ç¡®å»¶æ—¶ï¼Œåˆ›é€ è‡ªç„¶çš„è¡Œä¸ºåºåˆ—
- âœ… **å¼‚æ­¥é“¾æ‰§è¡Œ**: æ”¯æŒå¤æ‚çš„è¡Œä¸ºé“¾ï¼ŒåŠ¨ä½œå¯ä»¥äº§ç”Ÿåç»­åŠ¨ä½œ
- âœ… **é”™è¯¯å¤„ç†**: å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå•ä¸ªåŠ¨ä½œå¤±è´¥ä¸å½±å“æ•´ä½“ç³»ç»Ÿ
- âœ… **æ‰§è¡Œä¸Šä¸‹æ–‡**: ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ é€’ï¼Œæ”¯æŒå¤æ‚çš„è¡Œä¸ºé€»è¾‘

### 3. åŠ¨æ€æ‰©å±•èƒ½åŠ›
- âœ… **ç­–ç•¥æ³¨å†Œ**: è¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œæ–°çš„è¡Œä¸ºç­–ç•¥
- âœ… **ç­–ç•¥ç®¡ç†**: å¯ç”¨/ç¦ç”¨ã€ç§»é™¤ç­–ç•¥çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… **å¯¼å…¥å¯¼å‡º**: æ”¯æŒç­–ç•¥é…ç½®çš„æŒä¹…åŒ–å’Œè¿ç§»
- âœ… **ç»Ÿè®¡åˆ†æ**: è¯¦ç»†çš„æ‰§è¡Œç»Ÿè®¡ï¼ŒåŒ…æ‹¬æˆåŠŸç‡ã€æ‰§è¡Œæ—¶é—´ç­‰

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### æ¥å£è®¾è®¡

```typescript
// è¡Œä¸ºç­–ç•¥è§„åˆ™
interface BehaviorStrategyRule {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  name: string;                  // ç­–ç•¥åç§°
  description: string;           // ç­–ç•¥æè¿°
  state: PetState | PetState[];  // é€‚ç”¨çŠ¶æ€
  emotion: EmotionType | EmotionType[]; // é€‚ç”¨æƒ…ç»ª
  priority: number;              // ä¼˜å…ˆçº§ (æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜)
  conditions?: BehaviorCondition[]; // é¢å¤–è§¦å‘æ¡ä»¶
  actions: BehaviorAction[];     // è¡Œä¸ºåŠ¨ä½œåˆ—è¡¨
  cooldownMs?: number;           // å†·å´æ—¶é—´
  enabled: boolean;              // æ˜¯å¦å¯ç”¨
}

// è¡Œä¸ºåŠ¨ä½œ
interface BehaviorAction {
  type: string;                  // åŠ¨ä½œç±»å‹
  delayMs?: number;             // å»¶è¿Ÿæ—¶é—´
  execute: (context) => Promise<BehaviorActionResult>; // æ‰§è¡Œå‡½æ•°
}
```

### é»˜è®¤ç­–ç•¥é›†åˆ

1. **å¥½å¥‡æ¢ç´¢** (`curious_awaken_explore`)
   - è§¦å‘æ¡ä»¶: å”¤é†’çŠ¶æ€ + å¥½å¥‡æƒ…ç»ª
   - è¡Œä¸ºé“¾: æˆªå›¾æ’ä»¶(300mså»¶è¿Ÿ) â†’ æ¢ç´¢æç¤º(800mså»¶è¿Ÿ)
   - ä¼˜å…ˆçº§: 8

2. **ä¸“æ³¨å·¥å…·æ¨¡å¼** (`focused_control_tools`)
   - è§¦å‘æ¡ä»¶: æ§åˆ¶çŠ¶æ€ + ä¸“æ³¨æƒ…ç»ª
   - è¡Œä¸ºé“¾: æ¿€æ´»æ§åˆ¶é¢æ¿ â†’ é¢„åŠ è½½å·¥å…·æ’ä»¶(200mså»¶è¿Ÿ)
   - ä¼˜å…ˆçº§: 9

3. **å¼€å¿ƒäº’åŠ¨** (`happy_hover_interaction`)
   - è§¦å‘æ¡ä»¶: æ‚¬æµ®çŠ¶æ€ + å¼€å¿ƒæƒ…ç»ª
   - è¡Œä¸ºé“¾: å‹å¥½åé¦ˆ â†’ æ„‰æ‚¦åŠ¨ç”»(500mså»¶è¿Ÿ)
   - ä¼˜å…ˆçº§: 6

4. **è‡ªåŠ¨ä¼‘æ¯** (`sleepy_idle_rest`)
   - è§¦å‘æ¡ä»¶: ç©ºé—²çŠ¶æ€ + å›°å€¦æƒ…ç»ª + å¼ºåº¦â‰¥0.6
   - è¡Œä¸ºé“¾: ä¼‘æ¯åŠ¨ç”» â†’ æ—¶é—´æ„ŸçŸ¥æç¤º(5000mså»¶è¿Ÿ)
   - ä¼˜å…ˆçº§: 3

5. **é«˜èƒ½æ¨¡å¼** (`excited_awaken_highpower`)
   - è§¦å‘æ¡ä»¶: å”¤é†’çŠ¶æ€ + å…´å¥‹æƒ…ç»ª
   - è¡Œä¸ºé“¾: å…´å¥‹å“åº” â†’ å¿«é€Ÿå¯åŠ¨(100mså»¶è¿Ÿ) â†’ é«˜èƒ½æç¤º(600mså»¶è¿Ÿ)
   - ä¼˜å…ˆçº§: 10

6. **å¹³é™åŸºç¡€å“åº”** (`calm_universal_basic`)
   - è§¦å‘æ¡ä»¶: ä»»æ„çŠ¶æ€ + å¹³é™æƒ…ç»ª + å¼ºåº¦<0.8
   - è¡Œä¸ºé“¾: æƒ…ç»ªè¡¨è¾¾
   - ä¼˜å…ˆçº§: 2

## ğŸ“Š æµ‹è¯•ç»“æœ

### åŠŸèƒ½éªŒè¯ âœ…

- âœ… **ç­–ç•¥åŒ¹é…**: ç²¾ç¡®åŒ¹é…çŠ¶æ€+æƒ…ç»ªç»„åˆï¼Œæ”¯æŒå¤šçŠ¶æ€/å¤šæƒ…ç»ªç­–ç•¥
- âœ… **ä¼˜å…ˆçº§æ’åº**: æ­£ç¡®æŒ‰ä¼˜å…ˆçº§æ’åºæ‰§è¡Œ
- âœ… **æ¡ä»¶æ£€æŸ¥**: æƒ…ç»ªå¼ºåº¦æ¡ä»¶æ­£ç¡®å·¥ä½œ (ä½å¼ºåº¦0.4ä¸è§¦å‘ï¼Œé«˜å¼ºåº¦0.8è§¦å‘)
- âœ… **å»¶æ—¶æ‰§è¡Œ**: æ¯«ç§’çº§ç²¾ç¡®å»¶æ—¶ (300ms â†’ 800ms â†’ 5000msç­‰)
- âœ… **å†·å´æœºåˆ¶**: å†·å´æœŸå†…æ­£ç¡®é˜»æ­¢é‡å¤æ‰§è¡Œ
- âœ… **è‡ªå®šä¹‰ç­–ç•¥**: è¿è¡Œæ—¶æ³¨å†Œå’Œæ‰§è¡Œè‡ªå®šä¹‰ç­–ç•¥
- âœ… **ç­–ç•¥ç®¡ç†**: å¯ç”¨/ç¦ç”¨/ç§»é™¤åŠŸèƒ½æ­£å¸¸
- âœ… **å¯¼å…¥å¯¼å‡º**: ç­–ç•¥é…ç½®è¿ç§»åŠŸèƒ½æ­£å¸¸
- âœ… **è¾¹ç•Œå¤„ç†**: æ— åŒ¹é…ç­–ç•¥ã€ç©ºåŠ¨ä½œåˆ—è¡¨ç­‰è¾¹ç•Œæƒ…å†µå¤„ç†æ­£ç¡®

### æ€§èƒ½ç»Ÿè®¡ ğŸ“ˆ

```
ç­–ç•¥æ‰§è¡Œç»Ÿè®¡:
â€¢ å¥½å¥‡æ¢ç´¢: 1æ¬¡æ‰§è¡Œ, 100.0%æˆåŠŸç‡, å¹³å‡1102ms
â€¢ ä¸“æ³¨å·¥å…·: 1æ¬¡æ‰§è¡Œ, 100.0%æˆåŠŸç‡, å¹³å‡202ms  
â€¢ è‡ªåŠ¨ä¼‘æ¯: 1æ¬¡æ‰§è¡Œ, 100.0%æˆåŠŸç‡, å¹³å‡5002ms
â€¢ é«˜èƒ½æ¨¡å¼: 1æ¬¡æ‰§è¡Œ, 100.0%æˆåŠŸç‡, å¹³å‡703ms
â€¢ è‡ªå®šä¹‰ç­–ç•¥: 1æ¬¡æ‰§è¡Œ, 100.0%æˆåŠŸç‡, å¹³å‡0ms
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```typescript
import { createBehaviorStrategyManager } from './core/BehaviorStrategyManager';

// åˆ›å»ºç®¡ç†å™¨
const strategyManager = createBehaviorStrategyManager();

// è·å–åŒ¹é…ç­–ç•¥
const matches = strategyManager.getMatchingStrategies(
  PetState.Awaken, 
  EmotionType.Curious, 
  context
);

// æ‰§è¡Œç­–ç•¥
if (matches.length > 0) {
  const results = await strategyManager.executeStrategy(matches[0], context);
}
```

### è‡ªå®šä¹‰ç­–ç•¥æ³¨å†Œ

```typescript
const customStrategy: BehaviorStrategyRule = {
  id: 'my_custom_strategy',
  name: 'æˆ‘çš„è‡ªå®šä¹‰ç­–ç•¥',
  description: 'æ¼”ç¤ºè‡ªå®šä¹‰ç­–ç•¥æ³¨å†Œ',
  state: PetState.Hover,
  emotion: EmotionType.Happy,
  priority: 7,
  actions: [
    {
      type: 'custom_action',
      delayMs: 500,
      execute: async (context) => {
        // è‡ªå®šä¹‰è¡Œä¸ºé€»è¾‘
        return {
          success: true,
          message: 'è‡ªå®šä¹‰åŠ¨ä½œæ‰§è¡ŒæˆåŠŸ',
          data: { custom: true }
        };
      }
    }
  ],
  enabled: true
};

strategyManager.registerStrategy(customStrategy);
```

### æ¡ä»¶æ£€æŸ¥ç¤ºä¾‹

```typescript
const conditionalStrategy: BehaviorStrategyRule = {
  // ...å…¶ä»–é…ç½®
  conditions: [
    {
      type: 'emotion_intensity',
      operator: 'gte',
      value: 0.8  // æƒ…ç»ªå¼ºåº¦â‰¥0.8æ—¶æ‰è§¦å‘
    },
    {
      type: 'time_range', 
      operator: 'between',
      value: [9, 18]  // å·¥ä½œæ—¶é—´å†…æ‰è§¦å‘
    }
  ]
};
```

## ğŸ”§ æ‰©å±•èƒ½åŠ›

### 1. æ–°æƒ…ç»ªç±»å‹æ”¯æŒ

åªéœ€åœ¨ `EmotionType` æšä¸¾ä¸­æ·»åŠ æ–°ç±»å‹ï¼Œç„¶åæ³¨å†Œå¯¹åº”ç­–ç•¥ï¼š

```typescript
// å‡è®¾æ·»åŠ äº†æ–°æƒ…ç»ª EmotionType.Confused
const confusedStrategy: BehaviorStrategyRule = {
  id: 'confused_help',
  emotion: EmotionType.Confused,
  state: PetState.Awaken,
  actions: [/* å›°æƒ‘æ—¶çš„å¸®åŠ©è¡Œä¸º */]
};
```

### 2. æ–°çŠ¶æ€ç»„åˆæ”¯æŒ

æ”¯æŒä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šçš„çŠ¶æ€æƒ…ç»ªç»„åˆï¼š

```typescript
const multiStateStrategy: BehaviorStrategyRule = {
  state: [PetState.Idle, PetState.Hover],  // å¤šçŠ¶æ€
  emotion: [EmotionType.Happy, EmotionType.Excited], // å¤šæƒ…ç»ª
  // ...
};
```

### 3. å¤æ‚è¡Œä¸ºé“¾

æ”¯æŒåŠ¨ä½œäº§ç”Ÿåç»­åŠ¨ä½œçš„å¤æ‚é“¾å¼æ‰§è¡Œï¼š

```typescript
const chainedAction: BehaviorAction = {
  type: 'primary_action',
  execute: async (context) => {
    return {
      success: true,
      message: 'ä¸»åŠ¨ä½œå®Œæˆ',
      nextActions: [  // åç»­åŠ¨ä½œ
        {
          type: 'follow_up',
          execute: async (ctx) => ({ success: true, message: 'åç»­åŠ¨ä½œ' })
        }
      ]
    };
  }
};
```

## ğŸ¯ é›†æˆå»ºè®®

### ä¸ BehaviorScheduler é›†æˆ

```typescript
// åœ¨ BehaviorScheduler ä¸­ä½¿ç”¨ç­–ç•¥ç®¡ç†å™¨
class BehaviorScheduler {
  private strategyManager = createBehaviorStrategyManager();
  
  async schedule(state: PetState, emotion: EmotionType) {
    const strategies = this.strategyManager.getMatchingStrategies(state, emotion);
    
    for (const strategy of strategies) {
      await this.strategyManager.executeStrategy(strategy, context);
    }
  }
}
```

### ä¸ PetBrainBridge é›†æˆ

ç­–ç•¥ç®¡ç†å™¨å¯ä»¥ä½œä¸º PetBrainBridge çš„åº•å±‚æ‰§è¡Œå¼•æ“ï¼Œæä¾›æ›´æ™ºèƒ½çš„è¡Œä¸ºè°ƒåº¦ã€‚

## âœ… æ€»ç»“

T3-B è¡Œä¸ºç­–ç•¥å°è£…æ¨¡å—æˆåŠŸå®ç°äº†æ‰€æœ‰è®¾è®¡ç›®æ ‡ï¼š

1. âœ… **çµæ´»çš„æ˜ å°„ç³»ç»Ÿ**: æ”¯æŒå¤æ‚çš„çŠ¶æ€+æƒ…ç»ªç»„åˆ
2. âœ… **ä¼˜å…ˆçº§å’Œå»¶æ—¶**: ç²¾ç¡®çš„æ‰§è¡Œæ§åˆ¶
3. âœ… **åŠ¨æ€æ‰©å±•**: è¿è¡Œæ—¶ç­–ç•¥ç®¡ç†
4. âœ… **å¥å£®æ€§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
5. âœ… **å¯è§‚æµ‹æ€§**: è¯¦ç»†çš„æ‰§è¡Œç»Ÿè®¡å’Œæ—¥å¿—

è¯¥æ¨¡å—ä¸º SaintGrid ç¥å® ç³»ç»Ÿæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„è¡Œä¸ºç®¡ç†åŸºç¡€ï¼Œå¯ä»¥è½»æ¾é€‚åº”æ–°çš„éœ€æ±‚å’ŒåŠŸèƒ½æ‰©å±•ã€‚
